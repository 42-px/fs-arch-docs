# üíæ Data Access Layer

–°–ª–æ–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –º—ã –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –±—É–¥–µ–º –Ω–∞–∑—ã–≤–∞—Ç—å DAL (Data Access Layer).

–î–∞–Ω–Ω—ã–π —Ç–µ—Ä–º–∏–Ω –ø–æ–∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω –∏–∑ –º–∏—Ä–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–µ—Å–ª–∏ –µ—â–µ —Ç–æ—á–Ω–µ–µ ‚Äî –∏–∑ .NET). –û–¥–Ω–∞–∫–æ –≤–µ—Å—å–º–∞ —É–¥–∞—á–Ω–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–æ–ª—å —ç—Ç–æ–≥–æ —Å–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

> –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö ‚Äî –≤–µ—â—å –∏–∑–º–µ–Ω—á–∏–≤–∞—è.

–í—Å–µ–º –∑–Ω–∞–∫–æ–º–∞ —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –¥–∞–∂–µ –Ω–∞ –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–º–µ–∂—É—Ç–∫–∞—Ö –≤—Ä–µ–º–µ–Ω–∏ –≤ –∂–∏–≤–æ–º –ø—Ä–æ–µ–∫—Ç–µ –º–µ–Ω—è–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ HTTP-API, –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ HTTP-API –ø–æ—è–≤–ª—è–µ—Ç—Å—è socket.io —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–ª–∏ —Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ HTTP-API) –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.

–ü—Ä–∏ —ç—Ç–æ–º —Ç–∏–ø—ã –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –æ–±–ª–∞–¥–∞—é—Ç –±–æ–ª—å—à–µ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å—é, —Ç–∞–∫ –∫–∞–∫ —è–≤–ª—è—é—Ç—Å—è —Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–µ–π –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏.

–ù–∞—à–∞ –≥–ª–∞–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è —á–∏—Å–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–µ—Å—Ç–∏ –ø—Ä–∏ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤.

–ü–æ—ç—Ç–æ–º—É –≤—Å–µ –∑–Ω–∞–Ω–∏—è –æ–± –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç DAL.

–î–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–µ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏ –º—É—Ç–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö (–∫–æ–ª–ª–µ–∫—Ü–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∏ —ç–≤–µ–Ω—Ç–æ–≤).

–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ –∑–¥–µ—Å—å —Ç–æ, —á—Ç–æ –≤–Ω–µ—à–Ω–µ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞—Ç—å –æ —Ç–æ–º, –æ—Ç–∫—É–¥–∞ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç. –ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–∞—Ç–∞–ª–æ–≥ –≤ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω –∏–º–µ–Ω–Ω–æ "dal", –∞ –Ω–µ "rest-api" –∏–ª–∏ "http".

DAL –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –≤–Ω–µ—à–Ω–µ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä, JWT access token.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å–ª–æ—è DAL –∏ –µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –Ω–∞ –Ω–∞—à–µ–º –¥–µ–º–æ-–ø—Ä–∏–º–µ—Ä–µ.

–í –∫–∞—Ç–∞–ª–æ–≥–µ `dal/request` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –º–æ–¥–µ–ª—å:

1. –°—Ç–æ—Ä `$accessToken`.
2. –°–æ–±—ã—Ç–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ `initAuthState, resetAuthState`.
3. –°–æ–±—ã—Ç–∏—è –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ `authenticate` –∏ `tokenChanged` (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º —Ä–µ—Ñ—Ä–µ—à–∞ —Ç–æ–∫–µ–Ω–∞).
4. –≠—Ñ—Ñ–µ–∫—Ç—ã-–æ–±–µ—Ä—Ç–∫–∏ –Ω–∞–¥ http-–∑–∞–ø—Ä–æ—Å–∞–º–∏ `requestFx` –∏ `authRequestFx`.

–í—Å—è –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –≤ [init.ts](https://github.com/42-px/frontend-architecture/tree/master/examples/react/src/dal/request/init.ts)
–ó–¥–µ—Å—å —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–æ—Ä `$accessToken` —Å —ç–≤–µ–Ω—Ç–∞–º–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è `requestFx` –∏ `authRequestFx`, –∞ —Ç–∞–∫–∂–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —á—Ç–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ `localStorage`.

–≠—Ñ—Ñ–µ–∫—Ç—ã —Å –≤–Ω–µ—à–Ω–∏–º API, –æ–±–æ—Ä–∞—á–∏–≤–∞—é—â–∏–µ http-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –≤ —Ñ–∞–π–ª–∞—Ö [auth.ts](https://github.com/42-px/frontend-architecture/tree/master/examples/react/src/dal/auth.ts) –∏ [products.ts](https://github.com/42-px/frontend-architecture/tree/master/examples/react/src/dal/products.ts).

–î–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç–∞ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º attachWrapper –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ [@42px/effector-extra](https://www.npmjs.com/package/@42px/effector-extra).

–¢—É—Ç —Å—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ `forward` –≤ [auth.ts](https://github.com/42-px/frontend-architecture/tree/master/examples/react/src/dal/auth.ts):

```typescript
forward({
  from: signInReqFx.doneData.map(({ token }) => token),
  to: authenticate,
})
```

–≠—Ç–æ—Ç `forward` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç `$accessToken` –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Ä–µ–∑–æ–ª–≤–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ `signInFx`. –í–Ω–µ—à–Ω–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –Ω–µ –Ω—É–∂–Ω–æ –æ–± —ç—Ç–æ–º –±–µ—Å–ø–æ–∫–æ–∏—Ç—å—Å—è.

> **Upd 12.11.23** –í –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ effector (v22) —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sample` –≤–º–µ—Å—Ç–æ `forward`.  
https://effector.dev/docs/api/effector/sample

–í—Å–µ —á—Ç–æ –æ—Å—Ç–∞–µ—Ç—Å—è –≤–Ω–µ—à–Ω–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:

1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ —Ç–æ—Ç –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å–∞–º–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ [features/app/model/init.ts](https://github.com/42-px/frontend-architecture/tree/master/examples/react/src/features/app/model/init.ts).
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è/–º—É—Ç–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å –∫ –Ω–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥. –ü—Ä–∏–º–µ—Ä –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –º–æ–¥–µ–ª–∏ [sign-in](https://github.com/42-px/frontend-architecture/tree/master/examples/react/src/features/sign-in/model/private.ts).

–î–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞ —è–≤–ª—è–µ—Ç—Å—è –ª–∏—à—å –æ–¥–Ω–æ–π –∏–∑ –≤–æ–∑–º–æ–∂–Ω—ã—Ö. –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–µ–π —Å–ª–æ—è DAL –∏ –µ–≥–æ API –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–∞–¥–∞—á –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –µ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–ø–æ—Å–æ–±–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

–ü–æ–º–∏–º–æ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏ –º—É—Ç–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö, —Å–ª–æ–π DAL —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –≤–Ω–µ—à–Ω–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é —Ç–∏–ø—ã –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π (–≤ –¥–µ–º–æ-–ø—Ä–∏–º–µ—Ä–µ —ç—Ç–æ `src/dal/entities.ts`) –∏ –º–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

_–ü–æ–¥—ã—Ç–æ–∂–∏–º:_

> –°–ª–æ–π DAL –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–Ω–µ—à–Ω–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é, –Ω–µ –∑–∞–≤–∏—Å—è—â—É—é –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏ –º—É—Ç–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö, –∞ —Ç–∞–∫–∂–µ —Ç–∏–ø—ã –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ –º–æ–∫–∏.
